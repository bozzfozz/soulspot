{# Hey future me - this is the sidebar navigation for the new UI. Uses request.url.path for active state highlighting.
   The queue_count variable should be passed from the router for badge display. The user variable is for avatar display.
   Keep this in sync with the routes in ui.py - if you add a new page, add a sidebar link here!
   
   STRUKTUR-KONZEPT (Nov 2025):
   - Main: Dashboard, Search (globale Einstiegspunkte)
   - Spotify: Alles was von Spotify kommt (online, cloud)
   - Local Library: Alles was heruntergeladen/lokal ist
   - Downloads: Queue, aktive Transfers
   - System: Settings, Dev-Tools
   
   ICONS: Bootstrap Icons (bi-*) - https://icons.getbootstrap.com/
#}

<!-- Sidebar -->
<aside class="app-sidebar" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
            <span class="sidebar-logo-text">S<i class="bi bi-disc vinyl-record-icon" style="color: #1DB954; font-size: 0.9em;"></i>ulSp<i class="bi bi-disc vinyl-record-icon" style="color: #1DB954; font-size: 0.9em;"></i>t</span>
        </a>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
        <!-- Main Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">Main</div>
            <a href="/" class="sidebar-item {% if request.url.path == '/' or request.url.path == '/dashboard' %}active{% endif %}">
                <i class="bi bi-house sidebar-item-icon"></i>
                <span class="sidebar-item-text">Dashboard</span>
            </a>
            <a href="/search" class="sidebar-item {% if request.url.path == '/search' %}active{% endif %}">
                <i class="bi bi-search sidebar-item-icon"></i>
                <span class="sidebar-item-text">Search</span>
            </a>
        </div>

        <!-- Spotify Section (Online/Cloud) -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-spotify" style="color: #1DB954; margin-right: 6px;"></i>Spotify
            </div>
            <a href="/auth" class="sidebar-item {% if request.url.path == '/auth' %}active{% endif %}">
                <i class="bi bi-plug sidebar-item-icon"></i>
                <span class="sidebar-item-text">Connect</span>
            </a>
            <a href="/playlists" class="sidebar-item {% if '/playlists' in request.url.path %}active{% endif %}">
                <i class="bi bi-list-ul sidebar-item-icon"></i>
                <span class="sidebar-item-text">Playlists</span>
            </a>
            <a href="/library/artists?source=spotify" class="sidebar-item {% if '/spotify/artists' in request.url.path %}active{% endif %}">
                <i class="bi bi-heart sidebar-item-icon"></i>
                <span class="sidebar-item-text">Followed Artists</span>
            </a>
        </div>

        <!-- Discover Section (no auth required!) -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-compass" style="color: #ff6b35; margin-right: 6px;"></i>Discover
            </div>
            <a href="/browse/new-releases" class="sidebar-item {% if '/browse/new-releases' in request.url.path %}active{% endif %}">
                <i class="bi bi-vinyl-fill sidebar-item-icon"></i>
                <span class="sidebar-item-text">New Releases</span>
            </a>
            <a href="/browse/charts" class="sidebar-item {% if '/browse/charts' in request.url.path %}active{% endif %}">
                <i class="bi bi-graph-up-arrow sidebar-item-icon"></i>
                <span class="sidebar-item-text">Charts</span>
            </a>
            <a href="/spotify/discover" class="sidebar-item {% if '/spotify/discover' in request.url.path %}active{% endif %}">
                <i class="bi bi-heart-pulse sidebar-item-icon"></i>
                <span class="sidebar-item-text">Similar Artists</span>
            </a>
        </div>

        <!-- Local Library Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-folder2-open" style="color: var(--accent-primary); margin-right: 6px;"></i>Library
            </div>
            <a href="/library" class="sidebar-item {% if request.url.path == '/library' %}active{% endif %}">
                <i class="bi bi-grid sidebar-item-icon"></i>
                <span class="sidebar-item-text">Overview</span>
            </a>
            <a href="/library/artists" class="sidebar-item {% if '/library/artists' in request.url.path %}active{% endif %}">
                <i class="bi bi-people sidebar-item-icon"></i>
                <span class="sidebar-item-text">Artists</span>
            </a>
            <a href="/library/compilations" class="sidebar-item {% if '/library/compilations' in request.url.path %}active{% endif %}">
                <i class="bi bi-collection sidebar-item-icon"></i>
                <span class="sidebar-item-text">Compilations</span>
            </a>
        </div>
        
        <!-- Library Tools Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">
                <i class="bi bi-tools" style="color: var(--text-muted); margin-right: 6px;"></i>Tools
            </div>
            <a href="/library/incomplete-albums" class="sidebar-item {% if '/library/incomplete-albums' in request.url.path %}active{% endif %}">
                <i class="bi bi-pie-chart sidebar-item-icon"></i>
                <span class="sidebar-item-text">Incomplete</span>
            </a>
            <a href="/library/duplicates" class="sidebar-item {% if '/library/duplicates' in request.url.path %}active{% endif %}">
                <i class="bi bi-files sidebar-item-icon"></i>
                <span class="sidebar-item-text">Duplicates</span>
            </a>
            <a href="/library/broken-files" class="sidebar-item {% if '/library/broken-files' in request.url.path %}active{% endif %}">
                <i class="bi bi-exclamation-triangle sidebar-item-icon"></i>
                <span class="sidebar-item-text">Broken Files</span>
            </a>
        </div>

        <!-- Downloads Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">Downloads</div>
            <a href="/downloads" class="sidebar-item {% if request.url.path == '/downloads' %}active{% endif %}">
                <i class="bi bi-clock-history sidebar-item-icon"></i>
                <span class="sidebar-item-text">Queue</span>
                {% if queue_count is defined and queue_count and queue_count > 0 %}
                <span class="sidebar-item-badge">{{ queue_count }}</span>
                {% endif %}
            </a>
            <a href="/download-manager" class="sidebar-item {% if '/download-manager' in request.url.path %}active{% endif %}">
                <i class="bi bi-arrow-down-circle sidebar-item-icon"></i>
                <span class="sidebar-item-text">Download Manager</span>
            </a>
        </div>

        <!-- System Section -->
        <div class="sidebar-section">
            <div class="sidebar-section-title">System</div>
            <a href="/settings" class="sidebar-item {% if request.url.path == '/settings' %}active{% endif %}">
                <i class="bi bi-gear sidebar-item-icon"></i>
                <span class="sidebar-item-text">Settings</span>
            </a>
            <a href="/settings/quality-profiles" class="sidebar-item {% if '/quality-profiles' in request.url.path %}active{% endif %}">
                <i class="bi bi-sliders sidebar-item-icon"></i>
                <span class="sidebar-item-text">Quality Profiles</span>
            </a>
            <a href="/settings/blocklist" class="sidebar-item {% if '/blocklist' in request.url.path %}active{% endif %}">
                <i class="bi bi-shield-x sidebar-item-icon"></i>
                <span class="sidebar-item-text">Blocklist</span>
            </a>
            <a href="/api/logs" class="sidebar-item {% if '/logs' in request.url.path %}active{% endif %}">
                <i class="bi bi-terminal sidebar-item-icon"></i>
                <span class="sidebar-item-text">Logs</span>
            </a>
            <a href="/styleguide" class="sidebar-item {% if '/styleguide' in request.url.path %}active{% endif %}">
                <i class="bi bi-palette sidebar-item-icon"></i>
                <span class="sidebar-item-text">Styleguide</span>
            </a>
        </div>
    </nav>

    <!-- Sidebar Footer: Worker Status + Theme Toggle -->
    {# Hey future me - dieser Footer zeigt den Status der Background-Worker + Theme Toggle!
       Ein einzelnes Spotify-Icon zeigt den kombinierten Status aller Worker.
       Bei Hover erscheint ein Tooltip mit Details (letzter Sync, etc).
       Klick navigiert zu den Settings.
       
       Theme Toggle: Zykelt dark → light → auto → dark
       
       Animation:
       - Idle: sanftes Pulsieren (grün)
       - Active/Syncing: drehendes Icon
       - Error: rotes Icon mit Pulsieren
       
       Auf Mobile: Touch auf Container öffnet Tooltip (via :focus-within)
    #}
    <div class="sidebar-footer">
        <!-- Worker Status -->
        <div class="worker-status"
             hx-get="/api/workers/status/html"
             hx-trigger="load, every 10s"
             hx-swap="innerHTML">
            <!-- Fallback bis HTMX lädt -->
            <div class="worker-indicator-single" tabindex="0">
                <a href="/settings?tab=spotify" class="worker-icon" data-status="idle" aria-label="Background Workers Status">
                    <i class="bi bi-disc vinyl-record-icon" style="color: #1DB954;"></i>
                </a>
            </div>
        </div>
        
        <!-- Theme Toggle -->
        {% include "includes/_theme_switcher.html" %}
    </div>
</aside>
