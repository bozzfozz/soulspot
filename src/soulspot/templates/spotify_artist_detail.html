{# Hey future me - Spotify Artist Detail page with albums!
   Shows artist info + all their albums/singles from Spotify.
   Albums auto-sync on page load. Click album to see tracks. #}

{% extends "base.html" %}

{% block title %}{{ artist.name if artist else 'Artist' }} - Spotify - SoulSpot{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav style="margin-bottom: var(--space-4);">
    <ol style="display: flex; align-items: center; gap: var(--space-2); font-size: var(--font-size-sm);">
        <li><a href="/spotify/artists" style="color: #1DB954;"><i class="bi bi-spotify"></i> Spotify</a></li>
        <li style="color: var(--text-muted);"><i class="bi bi-chevron-right" style="font-size: 0.6rem; margin: 0 var(--space-2);"></i></li>
        <li><a href="/spotify/artists" style="color: #1DB954;">Artists</a></li>
        <li style="color: var(--text-muted);"><i class="bi bi-chevron-right" style="font-size: 0.6rem; margin: 0 var(--space-2);"></i></li>
        <li style="color: var(--text-muted);">{{ artist.name if artist else 'Unknown' }}</li>
    </ol>
</nav>

{% if error %}
<div class="alert alert-error" style="margin-bottom: var(--space-6);">
    <i class="bi bi-exclamation-triangle"></i>
    <span>{{ error }}</span>
</div>
{% endif %}

{% if artist %}
<!-- Artist Header -->
<div class="artist-header">
    {% if artist.image_url %}
    <img src="{{ artist.image_url }}" alt="{{ artist.name }}" class="artist-header-image">
    {% else %}
    <div class="artist-header-avatar">
        {{ artist.name[0]|upper }}
    </div>
    {% endif %}
    <div class="artist-header-info">
        <span class="artist-header-label"><i class="bi bi-spotify" style="color: #1DB954;"></i> Spotify Artist</span>
        <h1 class="artist-header-name">{{ artist.name }}</h1>
        <div class="artist-header-meta">
            {% if artist.genres %}
            <div class="artist-header-genres">
                {% for genre in artist.genres[:5] %}
                <span class="genre-badge">{{ genre }}</span>
                {% endfor %}
            </div>
            {% endif %}
            {% if artist.follower_count %}
            <span class="meta-item">
                <i class="bi bi-people"></i>
                {{ "{:,}".format(artist.follower_count) }} followers
            </span>
            {% endif %}
            <span class="meta-item">
                <i class="bi bi-disc"></i>
                {{ album_count }} release{{ 's' if album_count != 1 else '' }}
            </span>
        </div>
        
        <!-- Follow/Unfollow Button (Hey future me - this uses the Follow API from Phase 1!) -->
        <div style="margin-top: var(--space-4);">
            <button id="follow-btn-{{ artist.spotify_id }}" 
                    class="btn btn-following"
                    onclick="unfollowArtist('{{ artist.spotify_id }}')"
                    style="background: linear-gradient(135deg, #1DB954, #1ed760); color: white;">
                <i class="bi bi-check-lg"></i>
                Following
            </button>
            <a href="https://open.spotify.com/artist/{{ artist.spotify_id }}" 
               target="_blank" 
               class="btn btn-ghost"
               style="margin-left: var(--space-2);">
                <i class="bi bi-box-arrow-up-right"></i>
                Open in Spotify
            </a>
        </div>
        
        {% if sync_stats and sync_stats.synced %}
        <span style="font-size: var(--font-size-sm); color: var(--text-muted); margin-top: var(--space-2); display: block;">
            <i class="bi bi-check" style="color: #1DB954;"></i>
            Albums synced
        </span>
        {% endif %}
    </div>
</div>

<!-- Albums Section -->
<div style="margin-top: var(--space-8);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
        <h2 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold);">
            Discography
        </h2>
        <div style="display: flex; gap: var(--space-2);">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="album">Albums</button>
            <button class="filter-btn" data-filter="single">Singles</button>
        </div>
    </div>

    {% if albums %}
    <div class="albums-grid" id="albums-grid">
        {% for album in albums %}
        <a href="/spotify/artists/{{ artist.spotify_id }}/albums/{{ album.spotify_id }}" 
           class="album-card" 
           data-type="{{ album.album_type }}">
            {% if album.image_url %}
            <img src="{{ album.image_url }}" alt="{{ album.name }}" class="album-cover">
            {% else %}
            <div class="album-cover-placeholder">
                <i class="bi bi-disc"></i>
            </div>
            {% endif %}
            <div class="album-info">
                <h3 class="album-name" title="{{ album.name }}">{{ album.name }}</h3>
                <div class="album-meta">
                    <span class="album-year">{{ album.release_date[:4] if album.release_date else 'Unknown' }}</span>
                    <span class="album-type-badge album-type-{{ album.album_type }}">{{ album.album_type|capitalize }}</span>
                </div>
                <span class="album-tracks">{{ album.total_tracks }} track{{ 's' if album.total_tracks != 1 else '' }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="bi bi-disc"></i>
        </div>
        <h3>No albums found</h3>
        <p>This artist has no albums on Spotify yet, or albums are still syncing.</p>
    </div>
    {% endif %}
</div>

<!-- Fans Also Like Section -->
{% if related_artists %}
{% set unfollowed_artists = related_artists | selectattr('is_following', 'equalto', false) | list %}
<div style="margin-top: var(--space-8);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
        <h2 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-bold);">
            <i class="bi bi-heart" style="color: #1DB954;"></i> Fans Also Like
        </h2>
        <div style="display: flex; gap: var(--space-2); align-items: center;">
            {% if unfollowed_artists %}
            <button id="show-unfollowed-btn" class="btn btn-ghost btn-sm" onclick="toggleUnfollowedFilter()">
                <i class="bi bi-funnel"></i> Show Unfollowed ({{ unfollowed_artists | length }})
            </button>
            <button id="follow-all-btn" class="btn btn-spotify btn-sm" onclick="followAllUnfollowed()">
                <i class="bi bi-plus-lg"></i> Follow All ({{ unfollowed_artists | length }})
            </button>
            {% endif %}
        </div>
    </div>

    <div class="related-artists-scroll" id="related-artists-container">
        {% for ra in related_artists %}
        <a href="/spotify/artists/{{ ra.spotify_id }}" 
           class="related-artist-card" 
           data-artist-id="{{ ra.spotify_id }}"
           data-is-following="{{ 'true' if ra.is_following else 'false' }}">
            {% if ra.image_url %}
            <img src="{{ ra.image_url }}" alt="{{ ra.name }}" class="related-artist-image">
            {% else %}
            <div class="related-artist-avatar">{{ ra.name[0]|upper }}</div>
            {% endif %}
            <div class="related-artist-name" title="{{ ra.name }}">{{ ra.name }}</div>
            <div class="related-artist-genres">
                {% for genre in ra.genres %}
                <span class="mini-genre">{{ genre }}</span>
                {% endfor %}
            </div>
            {% if ra.is_following %}
            <span class="following-badge"><i class="bi bi-check"></i> Following</span>
            {% else %}
            <button class="follow-btn-small" 
                    onclick="event.preventDefault(); event.stopPropagation(); followArtist('{{ ra.spotify_id }}', this)">
                <i class="bi bi-plus-lg"></i> Follow
            </button>
            {% endif %}
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <div class="empty-icon">
        <i class="bi bi-person-slash"></i>
    </div>
    <h3>Artist not found</h3>
    <p>The requested artist could not be found.</p>
    <a href="/spotify/artists" class="btn btn-primary">
        <i class="bi bi-arrow-left"></i>
        Back to Artists
    </a>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<style>
    .artist-header {
        display: flex;
        align-items: center;
        gap: var(--space-6);
        background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-xl);
        padding: var(--space-6);
    }
    .artist-header-image {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        object-fit: cover;
        box-shadow: var(--shadow-xl);
    }
    .artist-header-avatar {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1DB954, #1ed760);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
        font-weight: var(--font-weight-bold);
        color: white;
        box-shadow: var(--shadow-xl);
    }
    .artist-header-info {
        flex: 1;
    }
    .artist-header-label {
        font-size: var(--font-size-sm);
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    .artist-header-name {
        font-size: var(--font-size-4xl);
        font-weight: var(--font-weight-bold);
        margin: var(--space-2) 0;
    }
    .artist-header-meta {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: var(--space-4);
        color: var(--text-muted);
        font-size: var(--font-size-sm);
    }
    .artist-header-genres {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
    }
    .genre-badge {
        background: rgba(29, 185, 84, 0.2);
        color: #1DB954;
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-full);
        font-size: var(--font-size-xs);
    }
    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--space-2);
    }
    
    /* Filter buttons */
    .filter-btn {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-primary);
        color: var(--text-muted);
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-full);
        font-size: var(--font-size-sm);
        cursor: pointer;
        transition: all var(--transition-fast);
    }
    .filter-btn:hover {
        border-color: #1DB954;
        color: #1DB954;
    }
    .filter-btn.active {
        background: #1DB954;
        border-color: #1DB954;
        color: white;
    }
    
    /* Albums grid */
    .albums-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: var(--space-4);
    }
    .album-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        overflow: hidden;
        text-decoration: none;
        color: var(--text-primary);
        transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    .album-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
    }
    .album-cover {
        width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
    }
    .album-cover-placeholder {
        width: 100%;
        aspect-ratio: 1;
        background: var(--bg-tertiary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: var(--text-muted);
    }
    .album-info {
        padding: var(--space-3);
    }
    .album-name {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-bold);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: var(--space-1);
    }
    .album-card:hover .album-name {
        color: #1DB954;
    }
    .album-meta {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-1);
    }
    .album-year {
        font-size: var(--font-size-xs);
        color: var(--text-muted);
    }
    .album-type-badge {
        font-size: var(--font-size-xs);
        padding: 1px 6px;
        border-radius: var(--radius-sm);
    }
    .album-type-album {
        background: rgba(29, 185, 84, 0.2);
        color: #1DB954;
    }
    .album-type-single {
        background: rgba(168, 85, 247, 0.2);
        color: #a855f7;
    }
    .album-type-compilation {
        background: rgba(251, 146, 60, 0.2);
        color: #fb923c;
    }
    .album-tracks {
        font-size: var(--font-size-xs);
        color: var(--text-muted);
    }
    
    .empty-state {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-xl);
        padding: var(--space-12);
        text-align: center;
    }
    .empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto var(--space-4);
        background: var(--bg-tertiary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-3xl);
        color: var(--text-muted);
    }
    .empty-state h3 {
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-2);
    }
    .empty-state p {
        color: var(--text-muted);
        margin-bottom: var(--space-6);
    }
    .alert {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-4);
        border-radius: var(--radius-lg);
    }
    .alert-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
    }

    /* Related Artists / Fans Also Like */
    .related-artists-scroll {
        display: flex;
        gap: var(--space-4);
        overflow-x: auto;
        padding-bottom: var(--space-3);
        scroll-snap-type: x mandatory;
        scrollbar-width: thin;
        scrollbar-color: var(--border-primary) transparent;
    }
    .related-artists-scroll::-webkit-scrollbar {
        height: 6px;
    }
    .related-artists-scroll::-webkit-scrollbar-track {
        background: transparent;
    }
    .related-artists-scroll::-webkit-scrollbar-thumb {
        background: var(--border-primary);
        border-radius: 3px;
    }
    .related-artist-card {
        flex: 0 0 150px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        text-align: center;
        text-decoration: none;
        color: var(--text-primary);
        scroll-snap-align: start;
        transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .related-artist-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
        border-color: #1DB954;
    }
    .related-artist-image {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: var(--space-3);
    }
    .related-artist-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1DB954, #1ed760);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: var(--font-weight-bold);
        color: white;
        margin: 0 auto var(--space-3);
    }
    .related-artist-name {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-bold);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: var(--space-2);
    }
    .related-artist-card:hover .related-artist-name {
        color: #1DB954;
    }
    .related-artist-genres {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 4px;
        margin-bottom: var(--space-2);
        min-height: 20px;
    }
    .mini-genre {
        font-size: 9px;
        padding: 1px 6px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-full);
        color: var(--text-muted);
    }
    .following-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        padding: 4px 10px;
        background: rgba(29, 185, 84, 0.2);
        color: #1DB954;
        border-radius: var(--radius-full);
    }
    .follow-btn-small {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        padding: 4px 10px;
        background: transparent;
        border: 1px solid var(--border-primary);
        border-radius: var(--radius-full);
        color: var(--text-primary);
        cursor: pointer;
        transition: all var(--transition-fast);
    }
    .follow-btn-small:hover {
        background: #1DB954;
        border-color: #1DB954;
        color: white;
    }
    
    @media (max-width: 640px) {
        .artist-header {
            flex-direction: column;
            text-align: center;
        }
        .artist-header-image, .artist-header-avatar {
            width: 140px;
            height: 140px;
        }
        .artist-header-name {
            font-size: var(--font-size-2xl);
        }
        .artist-header-meta {
            justify-content: center;
        }
    }
</style>
<script>
// Filter albums by type
document.addEventListener('DOMContentLoaded', function() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const albumCards = document.querySelectorAll('.album-card');
    
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active state
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Filter albums
            albumCards.forEach(card => {
                const type = card.dataset.type;
                if (filter === 'all' || type === filter) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
});

// Hey future me - Unfollow artist function!
// Uses the Follow API endpoint from Phase 1. On success, redirects to artists list.
async function unfollowArtist(artistId) {
    const button = document.getElementById(`follow-btn-${artistId}`);
    if (!button) return;
    
    // Confirm before unfollowing
    if (!confirm('Do you want to unfollow this artist? This will also remove them from your synced artists.')) {
        return;
    }
    
    // Show loading state
    button.disabled = true;
    button.innerHTML = '<div class="spinner spinner-sm" style="border-color: white; border-top-color: transparent;"></div>';
    
    try {
        const response = await fetch(`/api/artists/spotify/${artistId}/follow`, {
            method: 'DELETE'
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.detail || 'Unfollow failed');
        }
        
        // Show success toast
        if (typeof ToastManager !== 'undefined') {
            ToastManager.success('Artist unfollowed successfully');
        }
        
        // Redirect to artists list after short delay
        setTimeout(() => {
            window.location.href = '/spotify/artists';
        }, 1000);
        
    } catch (error) {
        console.error('Unfollow error:', error);
        // Revert button state
        button.disabled = false;
        button.innerHTML = '<i class="bi bi-check-lg"></i> Following';
        
        if (typeof ToastManager !== 'undefined') {
            ToastManager.error(error.message || 'Failed to unfollow artist');
        } else {
            alert('Failed to unfollow artist: ' + error.message);
        }
    }
}

// Hey future me - Follow artist function for Related Artists section!
// On success, updates the button to "Following" state.
async function followArtist(artistId, button) {
    if (!button) return;
    
    // Show loading state
    button.disabled = true;
    button.innerHTML = '<div class="spinner spinner-sm" style="width: 12px; height: 12px; border-width: 2px;"></div>';
    
    try {
        const response = await fetch(`/api/artists/spotify/${artistId}/follow`, {
            method: 'POST'
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.detail || 'Follow failed');
        }
        
        // Update button to "Following" state
        const badge = document.createElement('span');
        badge.className = 'following-badge';
        badge.innerHTML = '<i class="bi bi-check"></i> Following';
        button.replaceWith(badge);
        
        // Update card's data attribute
        const card = badge.closest('.related-artist-card');
        if (card) {
            card.dataset.isFollowing = 'true';
        }
        
        // Update counters in buttons
        updateFollowAllCounts();
        
        // Show success toast
        if (typeof ToastManager !== 'undefined') {
            ToastManager.success('Artist followed successfully');
        }
        
    } catch (error) {
        console.error('Follow error:', error);
        // Revert button state
        button.disabled = false;
        button.innerHTML = '<i class="bi bi-plus-lg"></i> Follow';
        
        if (typeof ToastManager !== 'undefined') {
            ToastManager.error(error.message || 'Failed to follow artist');
        } else {
            alert('Failed to follow artist: ' + error.message);
        }
    }
}

// Hey future me - Toggle filter to show only unfollowed artists!
let showingUnfollowedOnly = false;
function toggleUnfollowedFilter() {
    showingUnfollowedOnly = !showingUnfollowedOnly;
    const container = document.getElementById('related-artists-container');
    const btn = document.getElementById('show-unfollowed-btn');
    const cards = container.querySelectorAll('.related-artist-card');
    
    cards.forEach(card => {
        if (showingUnfollowedOnly && card.dataset.isFollowing === 'true') {
            card.style.display = 'none';
        } else {
            card.style.display = '';
        }
    });
    
    if (showingUnfollowedOnly) {
        btn.innerHTML = '<i class="bi bi-funnel-fill"></i> Show All';
        btn.classList.add('active');
    } else {
        const unfollowedCount = container.querySelectorAll('.related-artist-card[data-is-following="false"]').length;
        btn.innerHTML = `<i class="bi bi-funnel"></i> Show Unfollowed (${unfollowedCount})`;
        btn.classList.remove('active');
    }
}

// Hey future me - Follow ALL unfollowed similar artists at once!
// Uses batch processing with sequential API calls to avoid rate limits.
async function followAllUnfollowed() {
    const container = document.getElementById('related-artists-container');
    const followAllBtn = document.getElementById('follow-all-btn');
    const unfollowedCards = container.querySelectorAll('.related-artist-card[data-is-following="false"]');
    
    if (unfollowedCards.length === 0) {
        if (typeof ToastManager !== 'undefined') {
            ToastManager.info('All artists are already followed!');
        }
        return;
    }
    
    if (!confirm(`Follow ${unfollowedCards.length} artists?`)) {
        return;
    }
    
    // Disable button and show progress
    followAllBtn.disabled = true;
    const originalText = followAllBtn.innerHTML;
    
    let followed = 0;
    let failed = 0;
    
    for (const card of unfollowedCards) {
        const artistId = card.dataset.artistId;
        const button = card.querySelector('.follow-btn-small');
        
        // Update button text to show progress
        followAllBtn.innerHTML = `<div class="spinner spinner-sm" style="width: 14px; height: 14px;"></div> ${followed + 1}/${unfollowedCards.length}`;
        
        try {
            const response = await fetch(`/api/artists/spotify/${artistId}/follow`, {
                method: 'POST'
            });
            
            if (response.ok) {
                followed++;
                // Update UI
                if (button) {
                    const badge = document.createElement('span');
                    badge.className = 'following-badge';
                    badge.innerHTML = '<i class="bi bi-check"></i> Following';
                    button.replaceWith(badge);
                }
                card.dataset.isFollowing = 'true';
            } else {
                failed++;
            }
        } catch (e) {
            failed++;
            console.error(`Failed to follow ${artistId}:`, e);
        }
        
        // Small delay between requests to be nice to Spotify API
        await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    // Update counters and button
    updateFollowAllCounts();
    followAllBtn.disabled = false;
    
    // Show result
    if (typeof ToastManager !== 'undefined') {
        if (failed === 0) {
            ToastManager.success(`Successfully followed ${followed} artists!`);
        } else {
            ToastManager.warning(`Followed ${followed} artists, ${failed} failed`);
        }
    }
    
    // If filtering was active, update view
    if (showingUnfollowedOnly) {
        toggleUnfollowedFilter();
        toggleUnfollowedFilter();
    }
}

// Update the counts in Follow All and Filter buttons
function updateFollowAllCounts() {
    const container = document.getElementById('related-artists-container');
    if (!container) return;
    
    const unfollowedCount = container.querySelectorAll('.related-artist-card[data-is-following="false"]').length;
    
    const followAllBtn = document.getElementById('follow-all-btn');
    const showUnfollowedBtn = document.getElementById('show-unfollowed-btn');
    
    if (unfollowedCount === 0) {
        // Hide both buttons if all followed
        if (followAllBtn) followAllBtn.style.display = 'none';
        if (showUnfollowedBtn) showUnfollowedBtn.style.display = 'none';
    } else {
        if (followAllBtn) {
            followAllBtn.innerHTML = `<i class="bi bi-plus-lg"></i> Follow All (${unfollowedCount})`;
        }
        if (showUnfollowedBtn && !showingUnfollowedOnly) {
            showUnfollowedBtn.innerHTML = `<i class="bi bi-funnel"></i> Show Unfollowed (${unfollowedCount})`;
        }
    }
}
</script>
{% endblock %}
