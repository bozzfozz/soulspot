{# Hey future me - this is the HTMX response fragment for Missing Albums!
   Called by /api/library/discovery/missing/{artist_id}
   Shows a grid of albums the user doesn't have in their library.
   Each card has a "Find & Download" button that searches for the album. #}

{% if error %}
<div class="alert alert-warning" style="display: flex; align-items: center; gap: var(--space-3);">
    <i class="bi bi-exclamation-triangle"></i>
    <span>{{ error }}</span>
</div>
{% elif albums|length == 0 %}
<div class="empty-state-small" style="text-align: center; padding: var(--space-6);">
    <i class="bi bi-check-circle" style="font-size: 2rem; color: var(--success);"></i>
    <p style="margin-top: var(--space-3); color: var(--text-muted);">
        {% if total == 0 %}
        No discography data yet. Run Discovery to fetch album lists.
        {% else %}
        You have all {{ total }} album{{ 's' if total != 1 else '' }} from this artist! ðŸŽ‰
        {% endif %}
    </p>
</div>
{% else %}
{# Stats banner #}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4); padding: var(--space-3); background: var(--bg-tertiary); border-radius: var(--radius-md);">
    <span style="font-size: var(--font-size-sm); color: var(--text-muted);">
        <i class="bi bi-vinyl" style="margin-right: var(--space-2);"></i>
        {{ owned }} of {{ total }} album{{ 's' if total != 1 else '' }} in your collection
    </span>
    <span style="font-size: var(--font-size-sm); font-weight: var(--font-weight-bold); color: var(--accent-secondary);">
        {{ missing }} missing
    </span>
</div>

{# Albums grid - using same compact layout as library_albums.html #}
<div class="albums-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--space-4);">
    {% for album in albums %}
    <a href="/search?q={{ (artist_name ~ ' ' ~ album.title)|urlencode }}" 
       class="missing-album-card" 
       style="background: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: var(--radius-lg); padding: var(--space-4); transition: transform var(--transition-fast), box-shadow var(--transition-fast); text-decoration: none; color: var(--text-primary); display: block;">
        {# Album cover #}
        <div class="album-cover" style="aspect-ratio: 1; position: relative; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: var(--radius-lg); margin-bottom: var(--space-3); overflow: hidden;">
            {% if album.cover_url %}
            <img src="{{ album.cover_url }}" alt="{{ album.title }}" loading="lazy" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                <i class="bi bi-disc" style="font-size: 3rem; color: rgba(255,255,255,0.4);"></i>
            </div>
            {% endif %}
            {# Album type badge - top-left like library albums #}
            {% if album.album_type == 'single' %}
            <span class="album-type-badge" style="position: absolute; top: 8px; left: 8px; backdrop-filter: blur(8px); background: rgba(59, 130, 246, 0.85); color: white; font-size: var(--font-size-xs); font-weight: var(--font-weight-semibold); padding: var(--space-1) var(--space-2); border-radius: var(--radius-md);">
                Single
            </span>
            {% elif album.album_type == 'ep' %}
            <span class="album-type-badge" style="position: absolute; top: 8px; left: 8px; backdrop-filter: blur(8px); background: rgba(139, 92, 246, 0.85); color: white; font-size: var(--font-size-xs); font-weight: var(--font-weight-semibold); padding: var(--space-1) var(--space-2); border-radius: var(--radius-md);">
                EP
            </span>
            {% elif album.album_type == 'compilation' %}
            <span class="album-type-badge" style="position: absolute; top: 8px; left: 8px; backdrop-filter: blur(8px); background: rgba(245, 158, 11, 0.85); color: white; font-size: var(--font-size-xs); font-weight: var(--font-weight-semibold); padding: var(--space-1) var(--space-2); border-radius: var(--radius-md);">
                Compilation
            </span>
            {% endif %}
            {# Source badge - bottom-right corner #}
            <span style="position: absolute; bottom: 8px; right: 8px; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; background: {% if album.source == 'deezer' %}#FF0092{% elif album.source == 'spotify' %}#1DB954{% else %}var(--bg-secondary){% endif %}; color: white;">
                {{ album.source }}
            </span>
        </div>
        {# Album info - matching library albums structure exactly #}
        <h3 class="album-title" style="font-size: var(--font-size-sm); font-weight: var(--font-weight-bold); margin: 0 0 var(--space-1) 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ album.title }}">
            {{ album.title }}
        </h3>
        <p class="album-artist" style="font-size: var(--font-size-xs); color: var(--text-muted); margin: 0 0 var(--space-2) 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ artist_name }}">
            {{ artist_name }}
        </p>
        <div class="album-meta" style="display: flex; justify-content: space-between; align-items: center; font-size: var(--font-size-xs); color: var(--text-muted);">
            <span>
                {% if album.total_tracks %}<i class="bi bi-music-note" style="margin-right: var(--space-1);"></i>{{ album.total_tracks }}{% endif %}
            </span>
            {% if album.release_date %}
            <span>{{ album.release_date[:4] }}</span>
            {% endif %}
        </div>
    </a>
    {% endfor %}
</div>
{% endif %}

<style>
.missing-album-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}
</style>
