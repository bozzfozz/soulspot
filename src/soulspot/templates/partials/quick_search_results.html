{#
Hey future me - this is the quick-search dropdown partial! It's loaded via HTMX from
/ui/search/quick and renders into search results areas. Works with both:
  1. Header search dropdown (old - quick-search-* classes)
  2. Command Palette (new - command-* classes)

Searches local library first (not Spotify!) because that's instant and doesn't need auth.
Shows up to 5 results max to keep dropdown compact. Each result links to the full detail page.
If query is empty, we show nothing. The "View all results" link goes to /search for full search.
#}
{% if query and query|length >= 2 %}
    {% if results and results|length > 0 %}
        {# Results list - compatible with both header dropdown and command palette #}
        {% for item in results[:10] %}
        <a href="{{ item.url }}" 
           class="command-item quick-search-item"
           role="option"
           data-href="{{ item.url }}">
            <div class="command-item-icon quick-search-item-icon">
                {% if item.image %}
                <img src="{{ item.image }}" alt="" loading="lazy">
                {% else %}
                    {% if item.type == 'track' %}
                    <i class="bi bi-music-note"></i>
                    {% elif item.type == 'artist' %}
                    <i class="bi bi-person"></i>
                    {% elif item.type == 'album' %}
                    <i class="bi bi-disc"></i>
                    {% elif item.type == 'playlist' %}
                    <i class="bi bi-list-ul"></i>
                    {% else %}
                    <i class="bi bi-search"></i>
                    {% endif %}
                {% endif %}
            </div>
            <div class="command-item-content quick-search-item-content">
                <div class="command-item-title quick-search-item-title">{{ item.name }}</div>
                {% if item.subtitle %}
                <div class="command-item-subtitle quick-search-item-subtitle">{{ item.subtitle }}</div>
                {% endif %}
            </div>
            <span class="command-item-type quick-search-item-type">{{ item.type }}</span>
        </a>
        {% endfor %}
        
        {% if results|length > 10 %}
        <div class="command-palette-footer-link quick-search-footer">
            <a href="/search?q={{ query | urlencode }}" class="command-item">
                <div class="command-item-icon">
                    <i class="bi bi-arrow-right"></i>
                </div>
                <div class="command-item-content">
                    <div class="command-item-title">View all {{ results|length }} results</div>
                </div>
            </a>
        </div>
        {% endif %}
    {% else %}
        {# Empty state handled by command palette JS #}
    {% endif %}
{% endif %}
