# npm Setup Guide

## Quick Start

### First-Time Setup (One Time Only)

```bash
# Install npm dependencies and generate package-lock.json
npm install

# Verify it worked
npm run build:css

# Commit the lockfile
git add package-lock.json
git commit -m "Add package-lock.json for reproducible builds"
```

### Why package-lock.json?

- **Reproducible builds** - Everyone gets the exact same versions
- **Docker builds work** - Container build uses exact versions from lockfile
- **CI/CD reliability** - Consistent builds in automation
- **Prevents version drift** - No surprise updates breaking things

### What's in package.json?

```json
{
  "name": "soulspot",
  "version": "0.1.0",
  "scripts": {
    "build:css": "tailwindcss -i ./src/soulspot/static/css/input.css -o ./src/soulspot/static/css/style.css --minify",
    "watch:css": "tailwindcss -i ./src/soulspot/static/css/input.css -o ./src/soulspot/static/css/style.css --watch"
  },
  "devDependencies": {
    "tailwindcss": "^3.4.1"
  }
}
```

**Dependencies:**
- **tailwindcss** - CSS framework and compiler

## Development Workflow

### Build CSS Once

```bash
npm run build:css
```

Generates: `src/soulspot/static/css/style.css` (minified, ~50KB)

### Watch Mode (Auto-rebuild on Changes)

```bash
npm run watch:css
```

Automatically rebuilds CSS as you edit `input.css`. Great for development.

### Edit CSS

Edit `src/soulspot/static/css/input.css`:
- Add new animations
- Modify components
- Update utilities

Changes auto-compile if using `watch:css`, or run `build:css` manually.

## Git Workflow

### After Making CSS Changes

```bash
# 1. Build CSS (if not using watch mode)
npm run build:css

# 2. Stage changes
git add src/soulspot/static/css/input.css
git add src/soulspot/static/css/style.css

# 3. Commit
git commit -m "Add new animations or update styles"
```

### Files to Commit

- ✅ `src/soulspot/static/css/input.css` - CSS source (you edit this)
- ✅ `src/soulspot/static/css/style.css` - CSS output (auto-generated)
- ✅ `package-lock.json` - Dependency versions (commit once after npm install)
- ✅ `package.json` - Package configuration (only if adding new packages)

### Files NOT to Commit

- ❌ `node_modules/` - Generated by npm, ignored in .gitignore
- ❌ `npm-debug.log` - Debug logs, ignored in .gitignore

## Troubleshooting

### npm install Fails

```bash
# Clear npm cache
npm cache clean --force

# Try again
npm install
```

### Permissions Issues

```bash
# On macOS/Linux with permissions errors
sudo chown -R $(whoami) ~/.npm
npm install
```

### CSS Not Building

```bash
# Check if npm is installed
node --version
npm --version

# Check if tailwindcss is installed
npx tailwindcss --version

# Manual build
npm run build:css

# With verbose output
npm run build:css -- --loglevel verbose
```

### tailwindcss Not Found

```bash
# Reinstall packages
rm -rf node_modules package-lock.json
npm install
npm run build:css
```

## Docker Build

The Docker build automatically:
1. Installs npm dependencies (using `npm install`)
2. Builds CSS (runs `npm run build:css`)
3. Includes minified CSS in container

**No manual CSS build needed before Docker build!**

```bash
# This handles everything including CSS compilation
docker build -t soulspot:latest .
```

## CI/CD Pipeline

When `package-lock.json` is committed:
```bash
npm ci  # Clean install using lockfile (what Docker now uses)
```

When building from git branch:
```bash
docker build --build-arg GIT_BRANCH=develop .
```

## Reference

**npm Commands:**
- `npm install` - Install dependencies (generates package-lock.json)
- `npm ci` - Clean install (requires package-lock.json)
- `npm run build:css` - Build CSS once
- `npm run watch:css` - Watch and auto-rebuild CSS
- `npm cache clean --force` - Clear cache

**Tailwindcss:**
- **Input:** `src/soulspot/static/css/input.css`
- **Output:** `src/soulspot/static/css/style.css`
- **Config:** `tailwind.config.js`

**Files:**
- `package.json` - Package metadata and scripts
- `package-lock.json` - Exact dependency versions (commit this)
- `tailwind.config.js` - Tailwindcss configuration
- `.gitignore` - Git ignore rules (updated to keep package-lock.json)
